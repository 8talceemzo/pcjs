          {%- comment %}
            Here's the complete hierarchy of software.json:

              The "top" level is the object type (eg, hardware, software, documentation)
              The second level is a "machine" aka platform key (eg, osi, pcx86, etc.)
              The third level is a set of category keys (eg, app, driver, lang, sys, etc.)
              The fourth level is a set of subcategory keys (eg, apl, basic, c, pascal, etc.)
              The fifth level is a set of vendor keys (eg, borland, dresearch, ibm, microsoft, etc.)
              The sixth level is a set of product keys (eg, quickbasic, visualbasic, etc.)
              The seventh level is a set of versions (eg, 1.00, 2.00, etc.) inside a @versions object
              The eighth level is a list of media items inside a @media array

            However, entries in software.json are allowed to "short-circuit" this hierarchy to some extent;
            ie, you can "jump" from platform, category, or subcategory directly to products by placing
            a "@products" key inside any of those three levels.  The "osi" section is one example: there
            is a limited amount of software for that platform, so there's no need to force users to drill
            down as much; the subcategories of BASIC programs are more like vendors, each subcategory has a
            list of products, and each product is a single media item (assumed whenever @versions is omitted).

            Other special keys include:

              @title: this should generally appear at every level, because the keys only describe
              the hierarchy of the objects, not their names; one exception are version entries, where
              the version key *is* the version number, and if a no @title is present for a version,
              a default title (product @title plus version key) will be used instead.

              @hardware: an optional entry inside a version to define a default hardware configuration.

              @autoMount: an optional entry inside a version to define a "custom" autoMount URL parameter,
              instead of the one automatically generated from the list of @media items; eg:

                "@autoMount": {
                  "A": {"@diskette": "IBM-PCDOS-200-DISK1"},
                  "B": {"@diskette": "IBM-PCDOS-200-DISK2"}
                }

              @bootable: if there is no "custom" autoMount setting, then one will be automatically generated
              from the @media items, and @bootable determines whether or not the first item will be loaded into
              the boot drive (assumed to be "A").

          {%- endcomment %}
          <ul class="pcjs-explorer-top">
            <li class="pcjs-explorer-fixed">Software
              <ul>
              {%- for machine in site.data.software -%}
                {%- capture machine_type -%}{{ machine[0] }}{%- endcapture -%}
                {%- capture software_type -%}{{ machine[1]['@type'] }}{%- endcapture -%}
                {%- capture software_path1 -%}{{ machine[1]['@path'] }}{%- endcapture -%}
                {%- capture machine_url -%}/machines{{ software_path1 }}/{%- endcapture -%}
                {%- assign diskette_drives = machine[1]['@diskette_drives'] -%}
                {%- assign categories = site.data[machine_type][software_type] %}
                <li class="pcjs-explorer-platform pcjs-explorer-closed" onclick="pcjsExplorerClick(this, event)">{{ machine[1]['@title'] }}
                  <ul>
                  {%- for category in categories -%}
                    {%- if site.developer %}
                    <!-- software category: {{ category[0] }} (hidden: {{ category[1]['@hidden'] }})-->
                    {%- endif -%}
                    {%- if category[0] contains '@' -%}{%- continue -%}{%- endif -%}
                    {%- if category[1]['@hidden'] -%}{%- continue -%}{%- endif -%}
                    {%- assign subcategories = category[1] -%}
                    {%- capture software_path2 -%}/{{ category[0] }}{%- endcapture %}
                    <li class="pcjs-explorer-category pcjs-explorer-closed" onclick="pcjsExplorerClick(this, event)">{{ category[1]['@title'] }}
                      <ul>
                    {%- for subcategory in subcategories -%}
                      {%- if site.developer %}
                        <!-- software subcategory: {{ subcategory[0] }} -->
                      {%- endif -%}
                      {%- if subcategory[0] == '@versions' -%}
                        {%- assign vendors = subcategories %}
                        {%- capture software_path3 -%}{%- endcapture -%}
                      {%- elsif subcategory[0] contains '@' -%}
                        {%- continue -%}
                      {%- else -%}
                        {%- assign vendors = subcategory[1] -%}
                        {%- capture software_path3 -%}/{{ subcategory[0] }}{%- endcapture %}
                        <li class="pcjs-explorer-subcategory pcjs-explorer-closed" onclick="pcjsExplorerClick(this, event)">{{ subcategory[1]['@title'] }}
                          <ul>
                      {%- endif -%}

                      {%- for vendor in vendors -%}
                        {%- if site.developer %}
                            <!-- software vendor: {{ vendor[0] }} -->
                        {%- endif -%}
                        {%- if vendor[0] == '@products' or vendor[0] == '@versions' -%}
                          {%- assign products = vendors -%}
                          {%- capture software_path4 %}{% endcapture -%}
                        {%- elsif vendor[0] contains '@' -%}
                          {%- continue -%}
                        {%- elsif vendor[1]['@products'] -%}
                          {%- assign products = vendor[1]['@products'] %}
                          {%- capture software_path4 -%}{%- endcapture -%}
                        {% else -%}
                            {%- assign products = vendor[1] -%}
                            {%- capture software_path4 -%}/{{ vendor[0] }}{%- endcapture %}
                            <li class="pcjs-explorer-vendor pcjs-explorer-closed" onclick="pcjsExplorerClick(this, event)">{{ vendor[1]['@title'] }}
                              <ul>
                        {%- endif -%}

                        {%- for product in products -%}
                          {%- if site.developer %}
                                <!-- software product: {{ product[0] }} -->
                          {%- endif -%}
                          {%- if product[0] == '@products' or product[0] == '@versions' -%}
                            {%- assign versions = product[1] -%}
                            {%- capture software_path5 %}{% endcapture -%}
                          {%- elsif product[0] contains '@' -%}
                            {%- continue -%}
                          {%- else -%}
                            {%- assign versions = product[1]['@versions'] %}
                            {%- capture software_path5 %}/{{ product[0] }}{% endcapture -%}
                                <li class="pcjs-explorer-product pcjs-explorer-closed" onclick="pcjsExplorerClick(this, event)">{{ product[1]['@title'] }}
                                  <ul>
                          {%- endif -%}

                          {%- for version in versions -%}
                            {%- if site.developer %}
                                    <!-- software version: {{ version[0] }} -->
                            {%- endif -%}
                            {%- assign release = version[1] -%}
                            {%- if release['@title'] -%}
                              {%- capture software_title %}{{ release['@title'] }}{% endcapture -%}
                            {%- else -%}
                              {%- capture software_title %}{{ product[1]['@title'] }}{% if version[0] != "" %} {{ version[0] }}{% endif %}{% endcapture -%}
                            {%- endif -%}
                            {%- capture hardware_url -%}{{ release['@hardware'] }}{%- endcapture -%}
                            {%- capture diskette_server -%}https://{{ release['@subdomain'] | default: "diskettes" }}.pcjs.org{%- endcapture -%}
                            {%- capture harddisk_server -%}https://{{ release['@subdomain'] | default: "harddisks" }}.pcjs.org{%- endcapture -%}
                            {%- capture software_url -%}{{ software_path1 }}{{ software_path2 }}{{ software_path3 }}{{ software_path4 }}{{ software_path5 }}{% if version[0] != "" %}/{{ version[0] }}{% endif %}{%- endcapture -%}
                            {%- capture software_id -%}{{ software_url | remove_first: "/" | replace: "/", "-" }}{%- endcapture -%}
                            {%- if site.developer %}
                                    <!-- machine_url: {{ machine_url }} -->
                                    <!-- hardware_url: {{ hardware_url }} -->
                                    <!-- software_url: {{ software_url }} -->
                                    <!-- software_id: {{ software_id }} -->
                            {%- endif -%}
                            {%- assign autoMount = "" -%}{%- assign autoDrive = "" -%}{%- assign autoState = "" -%}
                            {%- if hardware_url != "" -%}{%- comment -%} or page.permalink contains machine_url {%- endcomment -%}
                              {%- if release['@autoMount'] -%}
                                {%- capture autoMount -%}{% assign disk_num = 0 %}{% for drive in release['@autoMount'] %}{% assign disk_num = disk_num | plus:1 %}{{ drive[0] }}:{name:%22{% if drive[1]['@title'] %}{{ drive[1]['@title'] }}{% else %}{{ software_title }}{% if release['@title'] == nil and release['@media'].size > 1 %} (Disk {{ disk_num }}){% endif %}{% endif %}%22,path:%22{{ diskette_server }}{{ software_url }}/{{ drive[1]['@diskette'] }}.json%22},{% endfor %}@{%- endcapture -%}
                              {%- elsif release['@media'][0]['@diskette'] -%}
                                {%- if release['@bootable'] -%}{%- assign drive_num = 0 -%}{%- else -%}{%- assign drive_num = 1 -%}{%- endif -%}
                                {%- capture autoMount -%}{% assign disk_num = 0 %}{% for disk in release['@media'] %}{{ diskette_drives[drive_num] }}{% assign disk_num = disk_num | plus:1 %}{% assign drive_num = drive_num | plus:1 %}:{name:%22{% if disk['@title'] %}{{ disk['@title'] }}{% else %}{{ software_title }}{% if release['@title'] == nil and release['@media'].size > 1 %} (Disk {{ disk_num }}){% endif %}{% endif %}%22,path:%22{{ diskette_server }}{{ software_url }}/{{ disk['@diskette'] }}.json%22},{% if drive_num >= diskette_drives.size %}{% break %}{% endif %}{% endfor %}@{%- endcapture -%}
                              {%- endif -%}
                              {%- if release['@media'][0]['@harddisk'] -%}
                                {%- capture autoDrive -%}{% for disk in release['@media'] %}{ name:%22{{ disk['@name'] }}%22,type:{{ disk['@type'] }},path:%22{{ harddisk_server }}{{ software_url }}/{{ disk['@harddisk'] }}.json%22 },{% endfor %}@{%- endcapture -%}
                              {%- endif -%}
                              {%- if autoDrive != "" -%}{%- capture autoDrive -%}&drives=[ {{ autoDrive | replace: ",@", "" }} ]{%- endcapture -%}{%- endif -%}
                              {%- if autoMount != "" -%}{%- capture autoMount -%}&autoMount={ {{ autoMount | replace: ",@", "" }} }{%- endcapture -%}{%- endif -%}
                              {%- if release['@state'] -%}{%- capture autoState -%}&state={{ harddisk_server }}{{ software_url }}/{{ release['@state'] }}{%- endcapture -%}{%- endif -%}
                              {%- capture software_parms -%}{%- if hardware_url contains '?' -%}&{%- else -%}?{%- endif -%}software={{ software_url }}/{{ autoMount }}{{ autoDrive }}{{ autoState }}{%- endcapture -%}
                            {%- else -%}
                              {%- capture software_parms -%}/software{{ software_url }}/{%- endcapture -%}
                              {%- if release['@tape'] -%}
                                {%- capture software_parms -%}{{ software_parms }}?autoStart=true&autoMount={name:%22{{ software_title }}%22,path:%22/software{{ software_url }}/{{ release['@tape'] }}%22}{%- endcapture -%}
                              {%- endif -%}
                            {%- endif %}
                                    <li id="{{ software_id }}" class="pcjs-explorer-version pcjs-explorer-item">
                                      <a href="{{ hardware_url }}{{ software_parms }}">{{ software_title }}</a>
                                    </li>
                          {%- endfor -%}

                          {%- if software_path5 != "" %}
                                  </ul>
                                </li>
                          {%- endif -%}
                        {%- endfor -%}
                        {%- if software_path4 != "" %}
                              </ul>
                            </li>
                        {%- endif -%}
                      {%- endfor -%}
                      {%- if software_path3 != "" %}
                          </ul>
                        </li>
                      {%- endif -%}
                    {%- endfor -%}
                    {%- if software_path2 != "" %}
                      </ul>
                    </li>
                    {%- endif -%}
                  {%- endfor %}
                  </ul>
                </li>
              {%- endfor %}
              </ul>
            </li>
          </ul>
